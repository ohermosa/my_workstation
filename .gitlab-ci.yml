stages:
  - run-develop
  - run-master

ansible-lint:
  stage: run-develop
  before_script:
    - pip install ansible-lint
  script:
    - ansible-lint ansible/install.yml
  tags:
    - shell
    - gitlab2github

release:
  stage: run-master
  script:
    - git config --global user.email "${CI_EMAIL}"
    - git config --global user.name "${CI_USERNAME}"
    - if ! $(git remote show github 2&>1 /dev/null); then git remote add github https://${GITLAB_USER_LOGIN}:${GITHUB_TOKEN}@gitlab.com/ohermosa/my_workstation.git; fi
    - if ! $(git remote show gitea 2&>1 /dev/null); then git remote add gitea https://${GITLAB_USER_LOGIN}:${GITEA_TOKEN}@gitea.com/ohermosa/my_workstation.git; fi
    - git push github --tags
    - git push gitea --tags
  only:
    - master
  tags:
    - shell
    - gitlab2github

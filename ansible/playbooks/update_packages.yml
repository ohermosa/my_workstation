---

- import_playbook: load_distro_vars.yml

- hosts: localhost
  connection: local
  become: true
  become_method: sudo
  vars:
    ansible_user: "{{ lookup('env', 'USER') }}"
    ansible_user_dir: "/home/{{ lookup('env', 'USER') }}"
  tasks:
    - name: "[FEDORA] upgrade all packages to the latest version"
      yum:
        name: '*'
        state: latest
        update_cache: true
      when: linux_distribution == "fedora"

    - name: "[UBUNTU] Upgrade all packages to the latest version"
      vars:
        distros:
          - ubuntu
          - debian
      apt:
        name: "*"
        state: latest
        update_cache: true
        force_apt_get: true
      when: linux_distribution in distros

    - name: "[ARCH] upgrade all packages to the latest version"
      pacman:
        update_cache: yes
        upgrade: yes
      ignore_errors: true
      when: linux_distribution == "arch"

    - name: "Create {{ last_update_file }}"
      vars:
        last_update_file: "/var/tmp/.update"
      file:
        path: "{{ last_update_file }}"
        state: touch

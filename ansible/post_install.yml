---

- hosts: localhost
  connection: local
  vars:
    ansible_user: "{{ lookup('env', 'USER') }}"
    ansible_user_dir: "/home/{{ lookup('env', 'USER') }}"
  tasks:
    - import_tasks: load_distro_vars.yml
      tags:
        - always

- hosts: localhost
  connection: local
  vars:
    ansible_user: "{{ lookup('env', 'USER') }}"
    ansible_user_dir: "/home/{{ lookup('env', 'USER') }}"
  tasks:
    - name: "Check if there is any config for {{ post_install_user }}"
      stat:
        path: "post_install/{{ post_install_user }}"

    - name: "[FEDORA] upgrade all packages to the latest version"
      yum:
        name: '*'
        state: latest
        update_cache: true
      when: linux_distribution == "fedora"

    - name: "[UBUNTU] Upgrade all packages to the latest version"
      apt:
        name: "*"
        state: latest
        update_cache: true
        force_apt_get: true
      when: linux_distribution == "ubuntu"

    - import_role:
        name: "post_install/{{ post_install_user }}"

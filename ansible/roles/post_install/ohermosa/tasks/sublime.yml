---

- name: "[SUBLIME] check if sublime directory exists"
  stat:
    path: "/home/{{ ansible_user }}/.config/sublime-text-3"
  register: subl_response

- block:
    - name: "[SUBLIME] Wait until directory exist in Dropbox"
      wait_for:
        path: "{{ dropbox_dir }}/backups/Sublime/User"
        timeout: "{{ wait_dropbox_sync }}"

    - name: "[SUBLIME] Delete local directory for Sublime configuration"
      file:
        path: "/home/{{ ansible_user }}/.config/sublime-text-3/Packages/User"
        state: absent

    - name: "[SUBLIME] Create the symlink to Sublime config in Dropbox"
      file:
        src: "{{ dropbox_dir }}/backups/Sublime/User"
        dest: "/home/{{ ansible_user }}/.config/sublime-text-3/Packages/User"
        state: link
  when: subl_response.stat.exists

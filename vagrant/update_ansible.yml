---

- hosts: localhost
  connection: local
  tasks:
    - import_tasks: load_distro_vars.yml
      tags:
        - always

- hosts: all
  tasks:
    - import_tasks: load_distro_vars.yml
      tags:
        - always

- hosts: all
  become: true
  become_user: root
  tasks:
    - name: "[FEDORA] upgrade all packages to the latest version"
      yum:
        name: '*'
        state: latest
        update_cache: true
      when: linux_distribution == "fedora"

    - name: "[FEDORA] Install ansible"
      yum:
        name: ansible
        state: latest
        update_cache: true
      when: linux_distribution == "fedora"

    - name: "[UBUNTU] Upgrade all packages to the latest version"
      apt:
        name: "*"
        state: latest
        update_cache: true
        force_apt_get: true
      when: linux_distribution == "ubuntu"

    - name: "[UBUNTU] add ppa repository"
      apt_repository:
        validate_certs: no
        repo: 'ppa:ansible/ansible'
        state: present
        codename: "{{ ubuntu_codename }}"
      when: linux_distribution == "ubuntu"

    - name: "[UBUNTU] Update ansible"
      apt:
        name:
          - ansible
          - python-apt
        update_cache: true
        state: latest
        force_apt_get: true
      when: linux_distribution == "ubuntu"
